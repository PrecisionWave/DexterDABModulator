# Dexter BSP - First Stage Boot Loader
FSBL specific information.  
For tools and common BSP information see [Dexter BSP](build_bsp.md).  
Usually FSBL needs to be built only once unless external PS changes are made.

## Dependencies
1. [fpga.bit - Build the FPGA Bitstream](build_hdl.md)

## Building the fsbl.elf binary
1. Open the Vivado project created by [Build the FPGA Bitstream](build_hdl.md).
2. Make sure that at least "IP INTEGRATOR" / "Generate Block Design" was run.
   Ideally Generate Bitstream was run successfully.
3. File -> Export -> Export Hardware
4. "Export Hardware Platform" appears. Click Next.
6. Output: Choose "Pre-synthesis" or "include bitstream". Click Next.
7. Confirm XSA name and remember its path... Click Next.  
BTW: Default is `<dexter git repo>/hdl_pcw/projects/dexter/dexter/system_top.xsa`
8. Click Finish
9. Wait until generation is done
10. Open Vitis (e.g. Tools / Launch Vitis IDE)
11. Select a workspace path (prefer a new empty one)
12. Select "Create Applicaion Project"
13. Click Next in the welcome page if the welcome page appears
14. "Platform" dialog appears.
15. Click "Create a new platform from hardware (XSA)
16. Browse for XSA file
17. Find and select the system_top.xsa that was generated in step 7
18. Confirm automatic settings and press Next
19. "Application Project Details" dialog appears
20. Enter "fsbl" as application project name
21. Ensure ps7_cortex_a9_0 is selected
22. Press Next
23. "Domain" dialog appears
24. Confirm Operating System: standalone and Architecture: "32-bit"
25. Press Next
26. "Templates" dialog appears
27. Select "Zynq FSBL" in the "Embedded software development templates"
28. Click Finish
27. Wait until generation is complete
28. Press "ctrl-b" on the keyboard to build everything
29. Wait until Build Finished appear

Files generated by this process:
- `<workspace>/fsbl/Debug/fsbl.elf`

30. Copy the `fsbl.elf` file over to the BOOT input folder `<dexter git repo>/BOOT/in/zx2`
   and name it once `fsbl.elf.dexter7010` and `fsbl.elf.dexter7020`.
