# Dexter BSP - BOOT.BIN
BOOT.BIN image creation specific information.  
For tools and common BSP information see [Dexter BSP](build_bsp.md).

## Dependencies
To build the boot.bin the following input files must be built first:
1. [fpga.bit - Build the FPGA Bitstream](build_hdl.md)
2. [fsbl.elf - Build the First Stage Boot Loader](build_fsbl.md)
3. [u-boot.elf and uboot.scr - Build Das U-Boot bootloader](build_bsp_uboot.md)

## FPGA Bitstream location
The generated bitstream named `system_top.bit` is hidden in the dexter Vivado project subdirectory
under `dexter/dexter.runs/impl_1` (or `dexter/dexter.runs/impl_2`).  
Full paths:  
- `<dexter git repo>/hdl_pcw/projects/dexter/dexter/dexter.runs/impl_1/system_top.bit`  
- `<dexter git repo>/hdl_pcw/projects/dexter/dexter/dexter.runs/impl_2/system_top.bit`  
The generated bitstream files need to be copied over to the BOOT/in/zx2 folder and renamed to fpga.bit.{TARGET}.
The `build-dexter.sh` script will do this and name the files `fpga.bit.dexter7020` and `fpga.bit.dexter7010`.

## BOOT.bin generation process
The `build-dexter.sh` script copies over the bitstreams from the default hdl directories
and then executes the `build-zx2.sh` script.  

The `build-zx2.sh` script will generate a BOOT.bin file for every fpga.bit file in `in/zx2/`.
In the `boot.bif` file are the ingridients to the boot.bin file listed: 
Usually the fpga.bit, fsbl.elf and u-boot.elf.  

The scirpt will do for each {TARGET}:
- copy fsbl.elf.{TARGET} -> fsbl.elf
- copy fpga.bit.{TARGET} -> fpga.bit
- mkbootimage boot.bif out/zx2/boot.bin.{TARGET}
- remove the temporary fsbl.elf and fpga.bit files

## Generate BOOT.bin.{TARGET}
```
cd <dexter git repo>/bsp_pcw/BOOT
./build-dexter.sh or ./build-zx2.sh
```

Files generated by build-dexter.sh:  
- `<dexter git repo>/bsp_pcw/BOOT/in/zx2/fpga.bit.dexter7020`
- `<dexter git repo>/bsp_pcw/BOOT/in/zx2/fpga.bit.dexter7010`

Files generated by build-zx2.sh and build-dexter.sh:  
- `<dexter git repo>/bsp_pcw/BOOT/out/zx2/BOOT.bin.dexter7020`
- `<dexter git repo>/bsp_pcw/BOOT/out/zx2/BOOT.bin.dexter7010`
- `<dexter git repo>/bsp_pcw/BOOT/out/zx2/uboot.scr`

## Notes
The `build-dexter.sh` script copies over the bitstreams from the default hdl directories
and then executes the `build-zx2.sh` script.  
The bitstreams can also be manually copied into the `in/zx2` directory and converted
to `boot.bin` files by executing only the `build-zx2.sh` script.
